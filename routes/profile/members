const express = require('express');
const router = express.Router();
const connection = require('../../db');
const cors = require('cors');
const { normalizeRows } = require("../components/normalizeKeys");

const corsOptions = {
    origin: '*',
    optionsSuccessStatus: 200
};

// GET all members
router.get('/:id', cors(corsOptions), function (req, res, next) {
    const id = req.params.id;
    const query = `  Select * FROM members m where id = ?
   `;
    connection.query(query, [id], function (err, results, fields) {
        if (!err) {
            if (results.length === 0) {
                res.status(404).json({
                    success: false,
                    message: 'Workout not found'
                });
            } else {
                const normalized = normalizeRows(results);
                res.json({
                    success: true,
                    data: normalized
                });
            }
        } else {
            next(err);
        }
    });
});

module.exports = router;